[env:pico32]
platform = espressif32
board = pico32
framework = arduino

; Serial Monitor options
monitor_speed = 115200

; Skip tests for pico32 (tests are designed for native environment only)
test_ignore = *

; Partition scheme - use more of the 4MB flash (3MB app space)
board_build.partitions = huge_app.csv

; Build options
; Feature flags for upload backends (enable only what you need to reduce binary size)
; 
; UPLOAD BACKEND SELECTION:
; Uncomment the appropriate flag(s) for your desired upload method(s).
; Only one backend is typically needed, but multiple can be enabled if you want
; to switch between them at runtime via config.json ENDPOINT_TYPE setting.
;
; Available backends:
;   - SMB/CIFS: Upload to Windows shares, NAS devices, or Samba servers
;   - WebDAV: Upload to Nextcloud, ownCloud, or WebDAV servers (TODO: not yet implemented)
;   - SleepHQ: Direct upload to SleepHQ cloud service (TODO: not yet implemented)
;
; Binary size impact (approximate):
;   - SMB: +220-270KB (includes libsmb2 library)
;   - WebDAV: +50-80KB (estimated, uses HTTPClient)
;   - SleepHQ: +40-60KB (estimated, uses HTTPClient + JSON)
;
; To use SMB upload:
;   1. Uncomment -DENABLE_SMB_UPLOAD below
;   2. Clone libsmb2: git clone https://github.com/sahlberg/libsmb2.git components/libsmb2
;   3. Set ENDPOINT_TYPE="SMB" in config.json
;
build_flags = 
    -DCORE_DEBUG_LEVEL=3
    -Icomponents/libsmb2/include
    -DENABLE_SMB_UPLOAD          ; Enable SMB/CIFS upload support
    ; -DENABLE_WEBDAV_UPLOAD     ; Enable WebDAV upload support (TODO: not yet implemented)
    ; -DENABLE_SLEEPHQ_UPLOAD    ; Enable SleepHQ direct upload (TODO: not yet implemented)
    ; -DENABLE_TEST_WEBSERVER    ; Enable test web server for on-demand upload testing (disabled by default for production)

; Library dependencies
lib_deps = 
    bblanchon/ArduinoJson@^6.21.3

; Extra library directories
lib_extra_dirs = components

; Note: MD5 checksums use ESP32 ROM functions (esp32/rom/md5_hash.h)
; instead of mbedtls to avoid linking issues

; Note: libsmb2 must be manually cloned into components/ directory
; Run: git clone https://github.com/sahlberg/libsmb2.git components/libsmb2
; The library will be automatically included as an ESP-IDF component

; Upload options
upload_speed = 921600

; Native testing environment
[env:native]
platform = native
build_flags = 
    -DUNIT_TEST
    -std=c++11
    -I include
    -I test/mocks
test_framework = unity
test_build_src = yes
; Exclude ESP32-specific source files from native build
; Tests will include only the specific components they need
build_src_filter = 
    -<*>
; TODO: Fix ArduinoJson 6.x compatibility issues in UploadStateManager
; The test has JsonObject/JsonArray conversion errors with ArduinoJson 6.21.3
; Need to update code to use .as<JsonObject>() and .as<JsonArray>() methods
test_ignore = test_upload_state_manager
